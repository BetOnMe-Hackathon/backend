<?php

namespace App\Http\Controllers;

use App\Jobs\ProcessOfferFromInsurer;
use Illuminate\Http\Request;

class WebHookController extends Controller
{

    public function receive(Request $request)
    {
        // \Log::info('x', $request->input());

        $input = json_decode('{"FromName":"Martins Sipenko","From":"martins.sipenko@gmail.com","FromFull":{"Email":"martins.sipenko@gmail.com","Name":"Martins Sipenko","MailboxHash":""},"To":"3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu","ToFull":[{"Email":"3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu","Name":"","MailboxHash":""}],"Cc":"","CcFull":[],"Bcc":"","BccFull":[],"OriginalRecipient":"3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu","Subject":"Re: Insurance quote request!","MessageID":"63fd73b1-2ac6-4db1-a253-28d0d111e1b7","ReplyTo":"","MailboxHash":"","Date":"Sat, 12 Nov 2016 08:59:53 -0800","TextBody":"99.99\r\n\r\n\r\nOn November 12, 2016 at 18:59:17,\r\n3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu (\r\n3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu) wrote:\r\n\r\nTransaction: 3x4gj6o3kzx0y9b817e8pl725vmqrn15\r\n","HtmlBody":"<html><head><style>body{font-family:Helvetica,Arial;font-size:13px}</style></head><body style=\"word-wrap:break-word\"><div id=\"bloop_customfont\" style=\"font-family:Helvetica,Arial;font-size:13px;color:rgba(0,0,0,1.0);margin:0px;line-height:auto\">99.99</div> <br> <div id=\"bloop_sign_1478969975717957120\" class=\"bloop_sign\"></div> <br><p class=\"airmail_on\">On November 12, 2016 at 18:59:17, <a href=\"mailto:3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu\">3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu</a> (<a href=\"mailto:3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu\">3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu</a>) wrote:</p> <blockquote type=\"cite\" class=\"clean_bq\"><span><div><div></div><div>\r\n\r\n\r\n<title></title>\r\n\r\n\r\nTransaction: 3x4gj6o3kzx0y9b817e8pl725vmqrn15<img src=\"http://ea.pstmrk.it/open/djFfMjAxNjExMTJfMTI1ODU4XzI0NzQxODFfX2ZmMGNhZDM2LWIxMTMtNDRkZi1hNDJjLTViZTA5Y2EyMWU0Nl9tYXJ0aW5zLnNpcGVua28raW5zdXJlcjFAZ21haWwuY29t\" width=\"1\" height=\"1\" border=\"0\" alt=\"\">\r\n\r\n\r\n</div></div></span></blockquote></body></html>\r\n","StrippedTextReply":"99.99\r\n\r\n\r\nOn November 12, 2016 at 18:59:17,\r\n3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu (\r\n3p5zkrvqg87x","Tag":"","Headers":[{"Name":"Received","Value":"by inbound.postmarkapp.com (Postfix, from userid 993)id 34FF4360AC3; Sat, 12 Nov 2016 16:59:56 +0000 (UTC)"},{"Name":"X-Spam-Checker-Version","Value":"SpamAssassin 3.4.0 (2014-02-07) onp-pm-inbound01-pktsjc1"},{"Name":"X-Spam-Status","Value":"No"},{"Name":"X-Spam-Score","Value":"2.0"},{"Name":"X-Spam-Tests","Value":"DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,FREEMAIL_FROM,HTML_IMAGE_ONLY_12,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,RCVD_IN_SORBS_SPAM,SPF_PASS,T_REMOTE_IMAGE,UNPARSEABLE_RELAY,URIBL_BLOCKED"},{"Name":"Received-SPF","Value":"Pass (sender SPF authorized) identity=mailfrom; client-ip=74.125.82.54; helo=mail-wm0-f54.google.com; envelope-from=martins.sipenko@gmail.com; receiver=3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu"},{"Name":"Received","Value":"from mail-wm0-f54.google.com (mail-wm0-f54.google.com [74.125.82.54])(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))(No client certificate requested)by inbound.postmarkapp.com (Postfix) with ESMTPS id 26AEE360AC2for <3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu>; Sat, 12 Nov 2016 11:59:55 -0500 (EST)"},{"Name":"Received","Value":"by mail-wm0-f54.google.com with SMTP id a197so29857554wmd.0        for <3p5zkrvqg87xonbo8re1l34j2p06ym9m@bidonme.eu>; Sat, 12 Nov 2016 08:59:54 -0800 (PST)"},{"Name":"DKIM-Signature","Value":"v=1; a=rsa-sha256; c=relaxed/relaxed;        d=gmail.com; s=20120113;        h=from:in-reply-to:references:mime-version:date:message-id:subject:to;        bh=Q0w2EfS5wfKeqiRBY7weQbzC/gItVScyvQbu3eJtUKU=;        b=MX3M/Yn00H5G0V607g6o5thSXtUKiCfio6TXBzjo/pjgyPuemLfuyTzkjLTgazPbTa         eqx8HfoZLANit83D9fELs0kOH0AqUYqyKDRnAiYtPJNax4Ckh5HN2eoXPW8H3v6dRh2x         2Ml2tJKq5tNy+KJK37q382/hZTgBrELoyhyWsRPGNRbjXNFeMQmiGf0KXTy7dPdB8zrG         H5//zgKhEln4GCxl1b/JW4KdbrUVpdYryMYehHAbZG4PMYdbf0iRG/i6qRf8Vq6lA++A         7rRP/7YUTYoG5Uxe0SYdWyfRx9ycJuo1Ul0T+pqPqKNAcNrwQg2AVB4cyfXq+XN8SoKR         DD2g=="},{"Name":"X-Google-DKIM-Signature","Value":"v=1; a=rsa-sha256; c=relaxed/relaxed;        d=1e100.net; s=20130820;        h=x-gm-message-state:from:in-reply-to:references:mime-version:date         :message-id:subject:to;        bh=Q0w2EfS5wfKeqiRBY7weQbzC/gItVScyvQbu3eJtUKU=;        b=Jy3y4ogYeoQwPGXTwnGqc6JJQhfaA75OAulM4PNsGjVsjP6l9jnD+NGg0D0An6gttz         3CwsIhWEMLpU4zhjaDLOwtZJS0PDZ2AkrAroir0JlXgROxN4Hkbbq6NEcdqJOANXwJvB         mRVjbV8UNIIngDYYyEzfbKA7Mys0s7S4fmjpXO6GWGmE1Dz/bDba79ittCEd7q7+snj0         UfIXKUozRJR1mp5oAP6fy2DHL8JTff+d3x5wuerFyk06tEgtCYy3D3QkUtIm2TgtCN3S         5iLzRF57nMcNYnrib8/9PoD/Jft02MRMwWdiwbj8ivrz71TWNFEpwFP+IcQuVhoMtu7q         70eg=="},{"Name":"X-Gm-Message-State","Value":"ABUngvdcALOdckjBkdsMZ8Uq+bkhwqaA4gzKEhKE49bdtSNFLXZXqZN7FB2GLoWawt7j4v0en1SDM3hWaOFW6g=="},{"Name":"X-Received","Value":"by 10.194.18.196 with SMTP id y4mr13721202wjd.73.1478969993489; Sat, 12 Nov 2016 08:59:53 -0800 (PST)"},{"Name":"Received","Value":"from 1058052472880 named unknown by gmailapi.google.com with HTTPREST; Sat, 12 Nov 2016 08:59:53 -0800"},{"Name":"In-Reply-To","Value":"<ff0cad36-b113-44df-a42c-5be09ca21e46@mtasv.net>"},{"Name":"References","Value":"<ff0cad36-b113-44df-a42c-5be09ca21e46@mtasv.net>"},{"Name":"X-Mailer","Value":"Airmail (390)"},{"Name":"MIME-Version","Value":"1.0"},{"Name":"Message-ID","Value":"<CA+4wLCADBJZb_x=7C+y5VY+mZmw2nRTeS5X7CMGHbokA1UvYpw@mail.gmail.com>"}],"Attachments":[]} ', true);

        dispatch(new ProcessOfferFromInsurer($input));

        return 'ok';
    }
}
